(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1171:function(t,e,n){"use strict";e.a=n.p+"i18n/languages.73e255d.json"},1172:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return c}));var i=n(3),o=n.n(i);function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){o()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const r={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontWeight:"bold",isUp:!1,isLeft:!1};class c{constructor(t={}){o()(this,"browser",{ff:void 0!==window.InstallTrigger,opera:!!window.opera||navigator.userAgent.includes("Opera")}),o()(this,"params",void 0),o()(this,"canvas",void 0),o()(this,"baseImage",void 0),o()(this,"context",void 0),o()(this,"icons",void 0),o()(this,"isReady",!1),o()(this,"readyCb",()=>{}),this.params=a(a({},r),t),this.icons=c.getIcons(),this.canvas=document.createElement("canvas"),this.baseImage=document.createElement("img");const e=this.icons[this.icons.length-1];e.hasAttribute("href")?(this.baseImage.setAttribute("crossOrigin","anonymous"),this.baseImage.onload=()=>{this.canvas.height=this.baseImage.height>0?this.baseImage.height:32,this.canvas.width=this.baseImage.width>0?this.baseImage.width:32,this.context=this.canvas.getContext("2d"),this.ready()},this.baseImage.setAttribute("src",e.getAttribute("href"))):(this.canvas.height=this.baseImage.height=32,this.canvas.width=this.baseImage.width=32,this.context=this.canvas.getContext("2d"),this.ready())}reset(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height)}options(t,e){const n={n:"number"==typeof t?Math.abs(t):t,len:(""+t).length,x:.4,y:.4,w:.6,h:.6};return e.isUp&&(n.y<.6?n.y=n.y-.4:n.y=n.y-2*n.y+(1-n.w)),e.isLeft&&(n.x<.6?n.x=n.x-.4:n.x=n.x-2*n.x+(1-n.h)),n.x=this.canvas.width*n.x,n.y=this.canvas.height*n.y,n.w=this.canvas.width*n.w,n.h=this.canvas.height*n.h,n}circle(t,e){const n=a(a({},this.params),e),i=this.options(t,n);let o=!1;2===i.len?(i.x=i.x-.4*i.w,i.w=1.4*i.w,o=!0):i.len>=3&&(i.x=i.x-.65*i.w,i.w=1.65*i.w,o=!0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height),this.context.beginPath();const s=Math.floor(i.h*(i.n>99?.85:1))+"px";if(this.context.font=`${n.fontWeight} ${s} ${n.fontFamily}`,this.context.textAlign="center",o?(this.context.moveTo(i.x+i.w/2,i.y),this.context.lineTo(i.x+i.w-i.h/2,i.y),this.context.quadraticCurveTo(i.x+i.w,i.y,i.x+i.w,i.y+i.h/2),this.context.lineTo(i.x+i.w,i.y+i.h-i.h/2),this.context.quadraticCurveTo(i.x+i.w,i.y+i.h,i.x+i.w-i.h/2,i.y+i.h),this.context.lineTo(i.x+i.h/2,i.y+i.h),this.context.quadraticCurveTo(i.x,i.y+i.h,i.x,i.y+i.h-i.h/2),this.context.lineTo(i.x,i.y+i.h/2),this.context.quadraticCurveTo(i.x,i.y,i.x+i.h/2,i.y)):this.context.arc(i.x+i.w/2,i.y+i.h/2,i.h/2,0,2*Math.PI),this.context.fillStyle=n.bgColor,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.stroke(),this.context.fillStyle=n.textColor,"number"==typeof i.n&&i.n>999){const t=(i.n>9999?9:Math.floor(i.n/1e3))+"k+";this.context.fillText(t,Math.floor(i.x+i.w/2),Math.floor(i.y+i.h-.2*i.h))}else this.context.fillText(""+i.n,Math.floor(i.x+i.w/2),Math.floor(i.y+i.h-.15*i.h));this.context.closePath()}ready(){this.isReady||(this.isReady=!0,this.readyCb())}setIcon(e){t(()=>{this.setIconSrc(e.toDataURL("image/png"))})}setIconSrc(t){if(this.browser.ff||this.browser.opera){const e=this.icons[this.icons.length-1],n=window.document.createElement("link");this.icons=[n],n.setAttribute("rel","icon"),n.setAttribute("type","image/png"),window.document.getElementsByTagName("head")[0].appendChild(n),n.setAttribute("href",t),e.parentNode&&e.parentNode.removeChild(e)}else this.icons.forEach(e=>{e.setAttribute("href",t)})}badge(t,e){this.isReady?("string"==typeof t||t>0?this.circle(t,e):this.reset(),this.setIcon(this.canvas)):this.readyCb=()=>{this.badge(t,e)}}static getLinks(){const t=[],e=window.document.getElementsByTagName("head")[0].getElementsByTagName("link");for(let n=0;n<e.length;n++)/(^|\s)icon(\s|$)/i.test(e[n].getAttribute("rel"))&&t.push(e[n]);return t}static getIcons(){let t=c.getLinks();return 0===t.length&&(t=[window.document.createElement("link")],t[0].setAttribute("rel","icon"),window.document.getElementsByTagName("head")[0].appendChild(t[0])),t.forEach(t=>{t.setAttribute("type","image/png")}),t}}}).call(this,n(316).setImmediate)},14:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(8),o=n.n(i);async function s(t=""){""===t||t.endsWith("/")||(t+="/");const e=a(`${t}config.${document.domain}.json`),n=a(t+"config.json");try{const t=await e;if(0===Object.keys(t).length)throw new Error;return t}catch(t){return await n}}function a(t){return new Promise((function(e,n){o()({method:"GET",url:t,qs:{cachebuster:Date.now()}},(t,i,o)=>{try{if(t||i.status<200||i.status>=300)return i&&(404==i.status||0==i.status&&""==o)&&e({}),void n({err:t,response:i});e(JSON.parse(o))}catch(t){n({err:t})}})}))}},32:function(t,e,n){"use strict";n.r(e),n.d(e,"rageshakePromise",(function(){return $})),n.d(e,"preparePlatform",(function(){return z})),n.d(e,"loadConfig",(function(){return Q})),n.d(e,"loadOlm",(function(){return J})),n.d(e,"loadLanguage",(function(){return Y})),n.d(e,"loadSkin",(function(){return X})),n.d(e,"loadTheme",(function(){return Z})),n.d(e,"loadApp",(function(){return tt})),n.d(e,"showError",(function(){return et})),n.d(e,"showIncompatibleBrowser",(function(){return nt})),n.d(e,"_t",(function(){return it}));var i=n(488),o=n(489),s=n.n(o),a=n(64),r=n(33),c=n.n(r),l=n(34),d=n(40),h=n(3),u=n.n(h),p=n(239),g=n(14),f=n(1172);class w extends p.b{constructor(){super(),u()(this,"_favicon",void 0),this.startUpdateCheck=this.startUpdateCheck.bind(this)}async getConfig(){return Object(g.a)()}getHumanReadableName(){return"Vector Base Platform"}get favicon(){return this._favicon?this._favicon:this._favicon=new f.a}_updateFavicon(){let t="#d00",e=this.notificationCount;this.errorDidOccur&&(e=e||"×",t="#f00"),this.favicon.badge(e,{bgColor:t})}setNotificationCount(t){this.notificationCount!==t&&(super.setNotificationCount(t),this._updateFavicon())}setErrorStatus(t){this.errorDidOccur!==t&&(super.setErrorStatus(t),this._updateFavicon())}startUpdater(){}getDefaultDeviceDisplayName(){return Object(l.a)("Unknown device")}}var m=n(1173),y=n(38),b=n(332),v=n(41),C=n(475),O=n(161),x=n(301),I=n(48),E=n(9),A=n(50),_=n(334);function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}const j=window.ipcRenderer,S=navigator.platform.toUpperCase().includes("MAC");function P(t){["call_state"].includes(t.action)&&j.send("app_onAction",t)}class N extends m.a{constructor(){super(),u()(this,"pendingIpcCalls",{}),u()(this,"nextIpcCallId",0),u()(this,"_onIpcReply",(t,e)=>{if(void 0===e.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[e.id])return void console.warn("Unknown IPC payload ID: "+e.id);const n=this.pendingIpcCalls[e.id];delete this.pendingIpcCalls[e.id],e.error?n.reject(e.error):n.resolve(e.reply)}),j.on("seshatReply",this._onIpcReply)}async _ipcCall(t,...e){const n=++this.nextIpcCallId;return new Promise((i,o)=>{this.pendingIpcCalls[n]={resolve:i,reject:o},window.ipcRenderer.send("seshat",{id:n,name:t,args:e})})}async supportsEventIndexing(){return this._ipcCall("supportsEventIndexing")}async initEventIndex(){return this._ipcCall("initEventIndex")}async addEventToIndex(t,e){return this._ipcCall("addEventToIndex",t,e)}async deleteEvent(t){return this._ipcCall("deleteEvent",t)}async isEventIndexEmpty(){return this._ipcCall("isEventIndexEmpty")}async commitLiveEvents(){return this._ipcCall("commitLiveEvents")}async searchEventIndex(t){return this._ipcCall("searchEventIndex",t)}async addHistoricEvents(t,e,n){return this._ipcCall("addHistoricEvents",t,e,n)}async addCrawlerCheckpoint(t){return this._ipcCall("addCrawlerCheckpoint",t)}async removeCrawlerCheckpoint(t){return this._ipcCall("removeCrawlerCheckpoint",t)}async loadFileEvents(t){return this._ipcCall("loadFileEvents",t)}async loadCheckpoints(){return this._ipcCall("loadCheckpoints")}async closeEventIndex(){return this._ipcCall("closeEventIndex")}async getStats(){return this._ipcCall("getStats")}async deleteEventIndex(){return this._ipcCall("deleteEventIndex")}}class T extends w{constructor(){super(),u()(this,"eventIndexManager",new N),u()(this,"pendingIpcCalls",{}),u()(this,"nextIpcCallId",0),u()(this,"ssoID",Object(E.a)(32)),y.a.register(P),j.on("check_updates",(t,e)=>{y.a.dispatch(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({action:A.a.CheckUpdates},function(t){return!0===t?{status:p.a.Downloading}:!1===t?{status:p.a.NotAvailable}:{status:p.a.Error,detail:t}}(e)))}),j.on("before-quit",(function(){console.log("riot-desktop closing"),b.b()})),j.on("ipcReply",this._onIpcReply.bind(this)),j.on("update-downloaded",this.onUpdateDownloaded.bind(this)),j.on("preferences",()=>{y.a.fire(A.a.ViewUserSettings)}),S?(Object(x.c)(x.a.NAVIGATION,{keybinds:[{modifiers:[x.b.COMMAND],key:I.a.COMMA}],description:Object(l.b)("Open user settings")}),Object(x.c)(x.a.NAVIGATION,{keybinds:[{modifiers:[x.b.COMMAND],key:I.a.SQUARE_BRACKET_LEFT},{modifiers:[x.b.COMMAND],key:I.a.SQUARE_BRACKET_RIGHT}],description:Object(l.b)("Previous/next recently visited room or community")})):Object(x.c)(x.a.NAVIGATION,{keybinds:[{modifiers:[x.b.ALT],key:I.a.ARROW_LEFT},{modifiers:[x.b.ALT],key:I.a.ARROW_RIGHT}],description:Object(l.b)("Previous/next recently visited room or community")}),this._ipcCall("startSSOFlow",this.ssoID)}async getConfig(){return this._ipcCall("getConfig")}async onUpdateDownloaded(t,{releaseNotes:e,releaseName:n}){this.shouldShowUpdate(n)&&Object(_.b)(await this.getAppVersion(),n,e)}getHumanReadableName(){return"Electron Platform"}setNotificationCount(t){this.notificationCount!==t&&(super.setNotificationCount(t),j.send("setBadgeCount",t))}supportsNotifications(){return!0}maySendNotifications(){return!0}displayNotification(t,e,n,i){navigator.userAgent.includes("Linux")&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const o={body:e,silent:!0};n&&(o.icon=n);const s=new window.Notification(t,o);return s.onclick=()=>{y.a.dispatch({action:"view_room",room_id:i.roomId}),window.focus(),this._ipcCall("focusWindow")},s}loudNotification(t,e){j.send("loudNotification")}clearNotification(t){t.close()}async getAppVersion(){return this._ipcCall("getAppVersion")}supportsAutoLaunch(){return!0}async getAutoLaunchEnabled(){return this._ipcCall("getAutoLaunchEnabled")}async setAutoLaunchEnabled(t){return this._ipcCall("setAutoLaunchEnabled",t)}supportsAutoHideMenuBar(){return!S}async getAutoHideMenuBarEnabled(){return this._ipcCall("getAutoHideMenuBarEnabled")}async setAutoHideMenuBarEnabled(t){return this._ipcCall("setAutoHideMenuBarEnabled",t)}supportsMinimizeToTray(){return!S}async getMinimizeToTrayEnabled(){return this._ipcCall("getMinimizeToTrayEnabled")}async setMinimizeToTrayEnabled(t){return this._ipcCall("setMinimizeToTrayEnabled",t)}async canSelfUpdate(){const t=await this._ipcCall("getUpdateFeedUrl");return Boolean(t)}startUpdateCheck(){super.startUpdateCheck(),j.send("check_updates")}installUpdate(){j.send("install_update")}getDefaultDeviceDisplayName(){return Object(l.a)("Riot Desktop (%(platformName)s)",{platformName:navigator.userAgent.includes("Macintosh")?"macOS":navigator.userAgent.includes("FreeBSD")?"FreeBSD":navigator.userAgent.includes("OpenBSD")?"OpenBSD":navigator.userAgent.includes("SunOS")?"SunOS":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("Linux")?"Linux":"Unknown"})}screenCaptureErrorString(){return null}requestNotificationPermission(){return Promise.resolve("granted")}reload(){window.location.reload(!1)}async _ipcCall(t,...e){const n=++this.nextIpcCallId;return new Promise((i,o)=>{this.pendingIpcCalls[n]={resolve:i,reject:o},window.ipcRenderer.send("ipcCall",{id:n,name:t,args:e})})}_onIpcReply(t,e){if(void 0===e.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[e.id])return void console.warn("Unknown IPC payload ID: "+e.id);const n=this.pendingIpcCalls[e.id];delete this.pendingIpcCalls[e.id],e.error?n.reject(e.error):n.resolve(e.reply)}getEventIndexingManager(){return this.eventIndexManager}setLanguage(t){this._ipcCall("setLanguage",t).catch(t=>{console.log("Failed to send setLanguage IPC to Electron"),console.error(t)})}getSSOCallbackUrl(t,e,n){const i=super.getSSOCallbackUrl(t,e,n);return i.protocol="riot",i.searchParams.set("riot-desktop-ssoid",this.ssoID),i}startSingleSignOn(t,e,n){super.startSingleSignOn(t,e,n),v.a.createTrackedDialog("Electron","SSO",C.a,{title:Object(l.a)("Go to your browser to complete Sign In"),description:c.a.createElement(O.a,null)})}_navigateForwardBack(t){this._ipcCall(t?"navigateBack":"navigateForward")}onKeyDown(t){let e=!1;switch(t.key){case I.a.SQUARE_BRACKET_LEFT:case I.a.SQUARE_BRACKET_RIGHT:!S||!t.metaKey||t.altKey||t.ctrlKey||t.shiftKey||(this._navigateForwardBack(t.key===I.a.SQUARE_BRACKET_LEFT),e=!0);break;case I.a.ARROW_LEFT:case I.a.ARROW_RIGHT:S||!t.altKey||t.metaKey||t.ctrlKey||t.shiftKey||(this._navigateForwardBack(t.key===I.a.ARROW_LEFT),e=!0)}return e}}var R=n(8),U=n.n(R),D=n(57),B=n.n(D),M=n(1174),F=n.n(M);function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}class V extends w{constructor(...t){super(...t),u()(this,"runningVersion",null),u()(this,"pollForUpdate",()=>this._getVersion().then(t=>{if(null===this.runningVersion)this.runningVersion=t;else{if(this.runningVersion!==t)return this.shouldShowUpdate(t)&&Object(_.b)(this.runningVersion,t),{status:p.a.Ready};Object(_.a)()}return{status:p.a.NotAvailable}},t=>(console.error("Failed to poll for update",t),{status:p.a.Error,detail:t.message||t.status?t.status.toString():"Unknown Error"})))}getHumanReadableName(){return"Web Platform"}supportsNotifications(){return Boolean(window.Notification)}maySendNotifications(){return"granted"===window.Notification.permission}requestNotificationPermission(){return new Promise((function(t,e){window.Notification.requestPermission(e=>{t(e)})}))}displayNotification(t,e,n,i){const o={body:e,tag:"vector",silent:!0};n&&(o.icon=n);const s=new window.Notification(t,o);s.onclick=function(){y.a.dispatch({action:"view_room",room_id:i.roomId}),window.focus(),s.close()}}_getVersion(){return new Promise((function(t,e){U()({method:"GET",url:"version",qs:{cachebuster:Date.now()}},(n,i,o)=>{if(n||i.status<200||i.status>=300)return null===n&&(n={status:i.status}),void e(n);const s=o.trim();t(s)})}))}getAppVersion(){return null!==this.runningVersion?Promise.resolve(this.runningVersion):this._getVersion()}startUpdater(){this.pollForUpdate(),setInterval(this.pollForUpdate,6e5)}async canSelfUpdate(){return!0}startUpdateCheck(){super.startUpdateCheck(),this.pollForUpdate().then(t=>{y.a.dispatch(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){u()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({action:A.a.CheckUpdates},t))})}installUpdate(){window.location.reload(!0)}getDefaultDeviceDisplayName(){const t=B.a.parse(window.location.href);t.protocol="",t.search="",t.hash="",t.pathname=t.pathname.replace(/\/$/,"");let e=t.format();e=e.replace(/^\/\//,"");const n=new F.a,i=n.getBrowser().name||"unknown browser";let o=n.getOS().name||"unknown OS";return"Mac OS"===o&&(o="macOS"),Object(l.a)("%(appName)s (%(browserName)s, %(osName)s)",{appName:e,browserName:i,osName:o})}screenCaptureErrorString(){return"https:"!==window.location.protocol?Object(l.a)("You need to be using HTTPS to place a screen-sharing call."):null}reload(){window.location.reload(!1)}}class W extends V{setNotificationCount(t){if(!navigator.setAppBadge)return super.setNotificationCount(t);this.notificationCount!==t&&(this.notificationCount=t,navigator.setAppBadge(t).catch(t=>{console.error("Failed to update PWA app badge",t)}))}}var H=n(51),K=n(45),q=n(231),G=n(330);window.mxSendRageshake=function(t,e){void 0===e&&(e=!0),t&&t.trim()?Object(G.a)(K.a.get().bug_report_endpoint_url,{userText:t,sendLogs:e,progressCallback:console.log.bind(console)}).then(()=>{console.log("Bug report sent!")},t=>{console.error(t)}):console.error("Cannot send a rageshake without a message - please tell us what went wrong")};const $=function(){const t=b.d();return t.then(()=>{console.log("Initialised rageshake."),console.log("To fix line numbers in Chrome: Meatball menu → Settings → Blackboxing → Add /rageshake\\.js$"),window.addEventListener("beforeunload",t=>{console.log("riot-web closing"),b.b()}),b.a()},t=>{console.error("Failed to initialise rageshake: "+t)}),t}();function z(){window.ipcRenderer?(console.log("Using Electron platform"),H.a.set(new T)):window.matchMedia("(display-mode: standalone)").matches?(console.log("Using PWA platform"),H.a.set(new W)):(console.log("Using Web platform"),H.a.set(new V))}async function Q(){K.a.put(await H.a.get().getConfig()||{})}function J(){return s.a.init({locateFile:()=>i.a}).then(()=>{console.log("Using WebAssembly Olm")}).catch(t=>(console.log("Failed to load Olm: trying legacy version",t),new Promise((t,e)=>{const n=document.createElement("script");n.src="olm_legacy.js",n.onload=t,n.onerror=e,document.body.appendChild(n)}).then(()=>window.Olm.init()).then(()=>{console.log("Using legacy Olm")}).catch(t=>{console.log("Both WebAssembly and asm.js Olm failed!",t)})))}async function Y(){const t=d.b.getValue("language",null,!0);let e=[];t?e=[t]:l.f().forEach(t=>{e.push(...l.g(t))});try{await l.k(e),document.documentElement.setAttribute("lang",l.d())}catch(t){console.error("Unable to set language",t)}}async function X(){console.log("Loading skin...");const[t,e]=await Promise.all([Promise.resolve().then(n.bind(null,36)),n.e(11).then(n.bind(null,1199))]);t.loadSkin(e),console.log("Skin loaded!")}async function Z(){Object(q.c)()}async function tt(t){const e=await n.e(10).then(n.bind(null,1190));window.matrixChat=a.render(await e.loadApp(t),document.getElementById("matrixchat"))}async function et(t,e){const i=(await n.e(5).then(n.bind(null,1191))).default;window.matrixChat=a.render(r.createElement(i,{title:t,messages:e}),document.getElementById("matrixchat"))}async function nt(t){const e=(await n.e(4).then(n.bind(null,1192))).default;window.matrixChat=a.render(r.createElement(e,{onAccept:t}),document.getElementById("matrixchat"))}const it=l.a}}]);
//# sourceMappingURL=init.js.map